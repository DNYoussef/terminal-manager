{"version":3,"names":["cov_m70w4v94s","actualCoverage","MAX_DEPTH","s","MAX_STRING_LENGTH","isDangerousKey","key","f","dangerous","includes","safeStringify","obj","space","b","seen","WeakSet","replacer","value","depth","undefined","has","add","length","substring","JSON","stringify","error","message","sanitizeObject","Array","isArray","map","item","sanitized","Object","create","keys","getOwnPropertyNames","err","parse","module","exports"],"sources":["safe-json-stringify.cjs"],"sourcesContent":["/**\r\n * Safe JSON Stringify - Prevents Prototype Pollution\r\n *\r\n * Filters out dangerous keys (__proto__, constructor, prototype)\r\n * Handles circular references safely\r\n * Prevents DoS from deeply nested objects\r\n */\r\n\r\nconst MAX_DEPTH = 20;\r\nconst MAX_STRING_LENGTH = 100000;\r\n\r\n/**\r\n * Check if key is dangerous\r\n */\r\nfunction isDangerousKey(key) {\r\n  const dangerous = ['__proto__', 'constructor', 'prototype'];\r\n  return dangerous.includes(key);\r\n}\r\n\r\n/**\r\n * Safe stringify with prototype pollution protection\r\n */\r\nfunction safeStringify(obj, space = 0) {\r\n  const seen = new WeakSet();\r\n\r\n  function replacer(key, value, depth = 0) {\r\n    // Filter dangerous keys\r\n    if (isDangerousKey(key)) {\r\n      return undefined;\r\n    }\r\n\r\n    // Prevent infinite depth\r\n    if (depth > MAX_DEPTH) {\r\n      return '[Max Depth Exceeded]';\r\n    }\r\n\r\n    // Handle circular references\r\n    if (typeof value === 'object' && value !== null) {\r\n      if (seen.has(value)) {\r\n        return '[Circular Reference]';\r\n      }\r\n      seen.add(value);\r\n    }\r\n\r\n    // Truncate long strings\r\n    if (typeof value === 'string' && value.length > MAX_STRING_LENGTH) {\r\n      return value.substring(0, MAX_STRING_LENGTH) + '...[Truncated]';\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  try {\r\n    return JSON.stringify(obj, (key, value) => replacer(key, value, 0), space);\r\n  } catch (error) {\r\n    // Fallback for stringify errors\r\n    return JSON.stringify({\r\n      error: 'Stringify failed',\r\n      message: error.message\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Sanitize object before stringifying (removes dangerous keys)\r\n * ISSUE #4 FIX: Uses Object.create(null) to prevent prototype pollution\r\n */\r\nfunction sanitizeObject(obj) {\r\n  if (obj === null || typeof obj !== 'object') {\r\n    return obj;\r\n  }\r\n\r\n  if (Array.isArray(obj)) {\r\n    return obj.map(item => sanitizeObject(item));\r\n  }\r\n\r\n  // Use Object.create(null) to create object without prototype\r\n  const sanitized = Object.create(null);\r\n\r\n  // Get all own property names (including non-enumerable)\r\n  const keys = Object.getOwnPropertyNames(obj);\r\n\r\n  for (const key of keys) {\r\n    // Skip dangerous keys\r\n    if (isDangerousKey(key)) {\r\n      continue;\r\n    }\r\n\r\n    try {\r\n      const value = obj[key];\r\n\r\n      // Recursively sanitize nested objects\r\n      if (typeof value === 'object' && value !== null) {\r\n        sanitized[key] = sanitizeObject(value);\r\n      } else {\r\n        sanitized[key] = value;\r\n      }\r\n    } catch (err) {\r\n      // Skip properties that throw errors on access\r\n      continue;\r\n    }\r\n  }\r\n\r\n  // Convert back to normal object to avoid serialization issues\r\n  return JSON.parse(JSON.stringify(sanitized));\r\n}\r\n\r\nmodule.exports = {\r\n  safeStringify,\r\n  sanitizeObject,\r\n  isDangerousKey\r\n};\r\n"],"mappings":"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","ignoreList":[]}